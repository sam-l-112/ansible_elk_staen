{% set _q_size_gb = (item.mem_gb * 2) | int  %}
{% set _cpu_cores = (ansible_processor_cores * ansible_processor_count) | int %}
{% if _cpu_cores > 8 %}
{% set _threads = 8 %}
{% else %}
{% set _threads = _cpu_cores %}
{% endif %}
# This file is where you define your pipelines. You can define multiple.
# For more information on multiple pipelines, see the documentation:
#   https://www.elastic.co/guide/en/logstash/current/multiple-pipelines.html

### NOTICE: This file is auto-generated by ansible, DO NOT edit this file manually!

- pipeline.id: {{ item.name }}-{{ item.port }}
  path.config: "/usr/share/logstash/pipeline"
  pipeline.batch.size : 1250
  pipeline.batch.delay : 50
  pipeline.workers : {{ _threads }}
  # Disk persistent queue size
  queue.type: persisted
  queue.max_bytes: {{ _q_size_gb }}gb
