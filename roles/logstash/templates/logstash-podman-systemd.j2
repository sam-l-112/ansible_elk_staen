{% set _memory_gb = (item.mem_gb * 2) | int  %}
### NOTICE: This file is auto-generated by ansible, DO NOT edit this file manually!

[Unit]
Description=Podman container-syslog-logstash-{{ item.port }}.service
Documentation=man:podman-generate-systemd(1)
Wants=network-online.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=always
TimeoutStopSec=70
ExecStartPre=/bin/rm -f %t/%n.ctr-id
ExecStart=/usr/bin/podman run \
	--cidfile=%t/%n.ctr-id \
	--cgroups=no-conmon \
	--rm \
	--sdnotify=conmon \
	--replace \
	--name=syslog-logstash-{{ item.port }} \
	-d \
	-e xpack.monitoring.enabled=true \
	-e "xpack.monitoring.elasticsearch.hosts=["{{ groups[syslog_global.cluster_group] | map('extract', hostvars, ['inventory_hostname']) | join(':9200","') }}:9200"]" \
	-e "LS_JAVA_OPTS=-Xms{{ item.mem_gb }}g -Xmx{{ item.mem_gb }}g" \
	-v /etc/hosts:/etc/hosts \
	-v /opt/syslog/logstash/{{ item.name }}-{{ item.port }}.conf:/usr/share/logstash/pipeline/logstash.conf \
	-v /opt/syslog/logstash/pipelines_{{ item.name }}-{{ item.port }}.yml:/usr/share/logstash/config/pipelines.yml \
	--network host \
	--log-driver=journald \
	-u logstash \
	--hostname syslog-logstash-{{ item.name }}-{{ item.port }} \
	-m {{ _memory_gb }}g localhost/logstash:latest /usr/share/logstash/bin/logstash
ExecStop=/usr/bin/podman stop --ignore --cidfile=%t/%n.ctr-id
ExecStopPost=/usr/bin/podman rm -f --ignore --cidfile=%t/%n.ctr-id
Type=notify
NotifyAccess=all

[Install]
WantedBy=default.target
