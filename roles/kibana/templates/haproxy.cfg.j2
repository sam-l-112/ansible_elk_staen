### NOTICE: This file is auto-generated by ansible, DO NOT edit this file manually!

listen syslog-kibana
        mode http
{% if kibana.haproxy.ssl_type is defined %}
        bind *:5601 ssl crt /etc/haproxy/ssl/{{ vars['global']['ssl'][kibana.haproxy.ssl_type]['domain'] }}.pem
{% else%}
        bind *:5601
{% endif %}
	timeout client 10m
	timeout connect 10m
	timeout server 10m
        balance leastconn
        stick-table type ip size 1000 expire 1d nopurge peers mypeers
{% if kibana.haproxy.users is defined %}
	acl is-kibana-admin path_reg /.*
        acl kibana_admin http_auth(kibana_admin-auth)
	http-request auth realm AuthRealm if is-kibana-admin !kibana_admin
{% endif %}

{% for _host in groups[syslog_global.cluster_group] | map('extract', hostvars, ['inventory_hostname']) %}
{% if loop.first %}
        server {{ syslog_global.cluster_group }}_{{ _host | replace('.','-') }} {{ _host }}:5601 check inter 5000 fall 3 rise 2
{% else %}
        server {{ syslog_global.cluster_group }}_{{ _host | replace('.','-') }} {{ _host }}:5601 check inter 5000 fall 3 rise 2 backup
{% endif %}
{% endfor %}

{% if kibana.haproxy.users is defined %}
{% set _json_list = vars['kibana']['haproxy']['users'] %}
userlist kibana_admin-auth
{% for _json in _json_list %}
        user {{ _json.name }} insecure-password {{ _json.password }}
{% endfor %}
{% endif %}
